<!doctype html>
<html lang="en">
<html>
<head>
<meta http-equiv='cache-control' content='no-cache'>
<meta http-equiv='expires' content='0'>
<meta http-equiv='pragma' content='no-cache'>
    <meta charset="UTF-8">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' /> 
    <title>PuckoDB</title>
    <style>
        body{
            background: #144766
        }
    </style>
    <script src="js/jquery-1.10.2.js"></script>
    <script src="pucko.js"></script>
    <script>
$(document).ready(function () {    
    //var pucko = new Pucko.Pucko('ws://192.168.2.2:9999/');
    var pucko = new Pucko.Pucko('ws://127.0.0.1:9999/');
    pucko.onObj((o) => {
        console.log("Object: " + o);        
        Object.keys(o).filter(k => k != 'type').forEach((v) => {
            $("#" + v).remove();
            $("#pucko").append(                
                '<div id="' + v + '">' +
                "<h2>" + v + "</h2>" + 
                "<h3>" + JSON.stringify(o[v]) + "</h3>" +
                "</div>"
            );
        });
    })
    pucko.connect().then((x) => { 
        return pucko.auth("magnus","correct");
    }).then((x) => {
        console.log("Login OK: " + x);            
        return pucko.replay(0);            
    }).catch((x) => {
            console.log("Error: " + x);
    });

    $("#addFoo").click(function(n) {
        pucko.create({ 'foo' : $("#textFoo").val() }).then((n) => {
            $("#textFoo").val("");
        }).catch((n) => {
            console.log("Failed: " + n);
        });
    });

    $("#updateEdit").click(function(n) {
        let h = {};
        let k = $("#keyEdit").val();        
        h[k] = $("#textEdit").val();
        pucko.update($("#uuidEdit").val(),h).then((n) => {
            $("#textEdit").val("");
        }).catch((n) => {
            console.log("Failed: " + n);
        });
    });
});
    </script>
</head>
<body>
<div id="wrapper">
	<br/>
    <div id="pucko"></div>
    <div>
        <input type="text" id="textFoo"><button id="addFoo">add</button>
    </div>
    <div>
        UUID:<input type="text" id="uuidEdit"><br>
        <input type="text" id="keyEdit">=<input type="text" id="textEdit"><button id="updateEdit">update</button>
    </div>
</div>
</body>
</html>
